# stepik_final_task
The finishing line
-------------------
# Подготовка окружения

1. Создайте отдельный публичный репозиторий с осмысленным названием на GitHub.

2. Склонируйте его к себе на локальную машину.

3. Добавьте туда файл conftest.py из предыдущего модуля. Убедитесь дополнительно, что там есть параметр для задания языка интерфейса, по умолчанию равный "en".

4. Убедитесь что ни во вложенных папках, ни во внешних папках нет других файлов conftest.py, почему это важно смотри здесь: Conftest.py — конфигурация тестов.

5. Добавьте в репозиторий файл requirements.txt из предыдущего модуля. 

6. Создайте пустой файл __init__.py, чтобы работали относительные импорты.

7. Создайте файл test_main_page.py и добавьте в него тест из предыдущего модуля: 
```
def test_guest_can_go_to_login_page(browser):
    link = "http://selenium1py.pythonanywhere.com/"
    browser.get(link)
    login_link = browser.find_element(By.CSS_SELECTOR, "#login_link")
    login_link.click()
```
8. Не забудьте активировать окружение, которое мы создали ранее. Опционально, можно создать для этого проекта новое виртуальное окружение для удобства. В таком случае убедитесь что вы установили туда все необходимые пакеты из requirements.txt. А еще не стоит добавлять файлы окружения в репозиторий и вообще в отслеживаемые — лишние файлы на GitHub это моветон. 

9. Убедитесь, что тест работает, с помощью следующей команды: pytest -v --tb=line --language=en test_main_page.py. Здесь и далее мы будем использовать эту команду для запуска. В этой команде мы использовали опцию PyTest --tb=line, которая указывает, что нужно выводить только одну строку из лога каждого упавшего теста. Так вам будет проще разобраться в том, как выглядят сообщения об ошибках.

10. Добавьте все новые файлы в Git командой git add *

11. Проверьте, что нужные файлы попали в планируемый коммит: git status

12. Зафиксируйте изменения коммитом с осмысленным сообщением: git commit -m "write your message".

13. По желанию добавьте описание репозитория с описанием вашего тестового проекта.

--------------------------------------------

# Базовая страница для проекта: BasePage

1. Создайте в своем проекте папку pages, там мы будем хранить все наши Page Object 

2. В папке создайте два файла: base_page.py и main_page.py  

Для начала сделаем базовую страницу, от которой будут унаследованы все остальные классы. В ней мы опишем вспомогательные методы для работы с драйвером.

3. В файле base_page.py создайте класс с названием BasePage. 

В Python такие вещи делаются с помощью следующей конструкции: 
```
class BasePage():
```
                  
4. Теперь в наш класс нужно добавить методы. Первым делом добавим конструктор — метод, который вызывается, когда мы создаем объект. Конструктор объявляется ключевым словом __init__. В него в качестве параметров мы передаем экземпляр драйвера и url адрес. Внутри конструктора сохраняем эти данные как аттрибуты нашего класса. Получается примерно так: 
```
def __init__(self, browser, url):
    self.browser = browser
    self.url = url
```
                  
5. Теперь добавим еще один метод open. Он должен открывать нужную страницу в браузере, используя метод get().

Объявите ниже в том же классе:
```
def open(self):
```
и реализуйте этот метод: нужна всего одна строка. Эту строку нужно отправить в качестве ответа на это задание, без отступов. 

6. После того как Stepik принял ваш ответ как правильный, добавьте новые файлы в Git и зафиксируйте изменения коммитом (не забудьте осмысленное сообщение).

В итоге у вас должен следующий код в файле base_page.py: 
```
class BasePage():
    def __init__(self, browser, url):
        self.browser = browser
        self.url = url

    def open(self): 
        # ваша реализация
```

------------------------------------------

# Page Object для главной страницы сайта

1. Откройте файл main_page.py 

2. В нем нужно сделать импорт базового класса BasePage: 
```
from .base_page import BasePage
```
                  
3. В нем создайте класс  MainPage. Его нужно сделать наследником класса BasePage. Класс-предок в Python указывается в скобках: 
```
class MainPage(BasePage): 
```
таким образом, класс MainPage будет иметь доступ ко всем атрибутам и методам своего класса-предка. 

4. Перенесите метод из предыдущего урока в класс MainPage:
```
def go_to_login_page(browser):
   login_link = browser.find_element(By.CSS_SELECTOR, "#login_link")
   login_link.click() 
```
                  
Чтобы все работало, надо слегка видоизменить его. В аргументы больше не надо передавать экземпляр браузера, мы его передаем и сохраняем на этапе создания Page Object. Вместо него нужно указать аргумент self , чтобы иметь доступ к атрибутам и методам класса: 
```
def go_to_login_page(self):
```
Так как браузер у нас хранится как аргумент класса BasePage, обращаться к нему нужно соответствующим образом с помощью self: 
```
self.browser.find_element(By.CSS_SELECTOR, "#login_link")
```
                  
Итого, файл main_page.py будет выглядеть так: 
```
from .base_page import BasePage
from selenium.webdriver.common.by import By

class MainPage(BasePage): 
    def go_to_login_page(self):
        login_link = self.browser.find_element(By.CSS_SELECTOR, "#login_link")
        login_link.click()
```

--------------------------------------

# Первый тест на основе Page Object

1. Откройте файл с вашим тестом test_main_page.py

2. В самом верху файла нужно импортировать класс, описывающий главную страницу: 
```
from .pages.main_page import MainPage
```
3. Теперь преобразуем сам тест в test_main_page.py: 
```
from .pages.main_page import MainPage

def test_guest_can_go_to_login_page(browser):
    link = "http://selenium1py.pythonanywhere.com/"
    page = MainPage(browser, link)   # инициализируем Page Object, передаем в конструктор экземпляр драйвера и url адрес 
    page.open()                      # открываем страницу
    page.go_to_login_page()          # выполняем метод страницы — переходим на страницу логина

```            
4. Убедитесь, что тест проходит, запустив его все той же командой: 
```
pytest -v --tb=line --language=en test_main_page.py
```
5. Добавьте изменения и сделайте коммит (с осмысленным сообщением!)

----------------------------------------

# Методы-проверки в Page Object

Допустим, нам нужно проверять такой сценарий: 

2. Открыть главную страницу 
3. роверить, что есть ссылка, которая ведет на логин 

Для этого в классе MainPage нужно реализовать метод, который будет проверять наличие ссылки. Обычно все такие методы-проверки называются похожим образом, мы будем называть их should_be_(название элемента). 

Итак, в классе MainPage создайте метод should_be_login_link. 

Для первой пробы можно реализовать его самым примитивным образом: 

```
def should_be_login_link(self):
    self.browser.find_element(By.CSS_SELECTOR, "#login_link_invalid")
```
                  
Сейчас мы намеренно сделали селектор неправильным, чтобы посмотреть, что именно выдаст тест, если поймает баг. Это хорошая практика: писать сначала красные тесты и только потом делать их зелеными.  

Добавляем в файл с тест-кейсами новый тест: 

```
def test_guest_should_see_login_link(browser):
    link = "http://selenium1py.pythonanywhere.com/"
    page = MainPage(browser, link)
    page.open()
    page.should_be_login_link()
```
                  
Запустите получившийся тест: 
```
pytest -v --tb=line --language=en test_main_page.py
```
